<?xml version="1.0" encoding="UTF-8"?>
<!-- WiX Toolset 安裝腳本 - 用於創建 MSI 安裝程式 -->
<!-- 需要先安裝 WiX Toolset: https://wixtoolset.org/ -->
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <Product Id="*" 
           Name="Relax Time" 
           Language="1028" 
           Version="0.2.0" 
           Manufacturer="Relax Time Team" 
           UpgradeCode="B1A2C3D4-E5F6-4A7B-8C9D-0E1F2A3B4C5D">
    
    <Package InstallerVersion="200" 
             Compressed="yes" 
             InstallScope="perUser" 
             Description="Windows 時間管理工具"
             Comments="Relax Time - 幫助您管理工作時間和休息時間" />
    
    <MajorUpgrade DowngradeErrorMessage="已經安裝了更新版本的 Relax Time。" />
    <MediaTemplate EmbedCab="yes" />
    
    <!-- 安裝目錄 -->
    <Property Id="ApplicationFolderName" Value="Relax Time" />
    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLFOLDER" />
    
    <UIRef Id="WixUI_Minimal" />
    
    <!-- 功能 -->
    <Feature Id="ProductFeature" Title="Relax Time" Level="1">
      <ComponentRef Id="ApplicationFiles" />
      <ComponentRef Id="ApplicationShortcut" />
      <ComponentRef Id="UninstallShortcut" />
    </Feature>
    
    <!-- 安裝目錄 -->
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="LocalAppDataFolder">
        <Directory Id="INSTALLFOLDER" Name="Relax Time">
          <Component Id="ApplicationFiles" Guid="A1B2C3D4-E5F6-4A7B-8C9D-0E1F2A3B4C5D">
            <File Id="RelaxTimeExe" 
                  Source="dist\RelaxTime.exe" 
                  KeyPath="yes" />
            <File Id="AlarmClockIcon" 
                  Source="resources\alarm_clock.ico" />
            <File Id="CountdownAlarm" 
                  Source="resources\countdown_alarm.mp3" />
            <RemoveFolder Id="INSTALLFOLDER" On="uninstall" />
            <RegistryValue Root="HKCU" 
                          Key="Software\Relax Time" 
                          Name="Installed" 
                          Type="integer" 
                          Value="1" 
                          KeyPath="no" />
          </Component>
          
          <!-- 快捷方式 -->
          <Component Id="ApplicationShortcut" Guid="B2C3D4E5-F6A7-4B8C-9D0E-1F2A3B4C5D6E">
            <Shortcut Id="ApplicationStartMenuShortcut"
                      Name="Relax Time"
                      Description="Windows 時間管理工具"
                      Target="[INSTALLFOLDER]RelaxTime.exe"
                      WorkingDirectory="INSTALLFOLDER" />
            <RemoveFolder Id="ApplicationProgramsFolder" On="uninstall" />
            <RegistryValue Root="HKCU" 
                          Key="Software\Relax Time" 
                          Name="Shortcut" 
                          Type="integer" 
                          Value="1" 
                          KeyPath="yes" />
          </Component>
        </Directory>
      </Directory>
      
      <!-- 開始菜單 -->
      <Directory Id="ProgramMenuFolder">
        <Directory Id="ApplicationProgramsFolder" Name="Relax Time">
          <Component Id="UninstallShortcut" Guid="C3D4E5F6-A7B8-4C9D-0E1F-2A3B4C5D6E7F">
            <Shortcut Id="UninstallProduct"
                      Name="解除安裝 Relax Time"
                      Target="[SystemFolder]msiexec.exe"
                      Arguments="/x [ProductCode]"
                      Description="解除安裝 Relax Time" />
            <RemoveFolder Id="ApplicationProgramsFolder" On="uninstall" />
            <RegistryValue Root="HKCU" 
                          Key="Software\Relax Time" 
                          Name="Uninstall" 
                          Type="integer" 
                          Value="1" 
                          KeyPath="yes" />
          </Component>
        </Directory>
      </Directory>
      
      <!-- 桌面快捷方式（可選） -->
      <Directory Id="DesktopFolder" Name="Desktop">
        <Component Id="DesktopShortcut" Guid="D4E5F6A7-B8C9-4D0E-1F2A-3B4C5D6E7F8A">
          <Shortcut Id="DesktopShortcut"
                    Name="Relax Time"
                    Description="Windows 時間管理工具"
                    Target="[INSTALLFOLDER]RelaxTime.exe"
                    WorkingDirectory="INSTALLFOLDER" />
          <RemoveFolder Id="DesktopFolder" On="uninstall" />
          <RegistryValue Root="HKCU" 
                        Key="Software\Relax Time" 
                        Name="DesktopShortcut" 
                        Type="integer" 
                        Value="1" 
                        KeyPath="yes" />
        </Component>
      </Directory>
    </Directory>
    
    <!-- 圖標 -->
    <Icon Id="ProductIcon" SourceFile="resources\alarm_clock.ico" />
    <Property Id="ARPPRODUCTICON" Value="ProductIcon" />
    
    <!-- 安裝後運行程式（可選） -->
    <CustomAction Id="LaunchApplication" 
                  Directory="INSTALLFOLDER" 
                  ExeCommand="[INSTALLFOLDER]RelaxTime.exe" 
                  Return="asyncNoWait" 
                  Impersonate="yes" />
    
  </Product>
</Wix>

